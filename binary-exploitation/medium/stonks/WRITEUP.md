[19/11/2024]

# Stonks

## Solution

The challenge requires some understing of C. First off, after taking a look at the *source code*, a function catches my interest:

```C
int buy_stonks(Portfolio *p) {
  if (!p) {
    return 1;
  }
  char api_buf[FLAG_BUFFER];
  FILE *f = fopen("api", "r");
  if (!f) {
    printf("Flag file not found. Contact an admin.\n");
    exit(1);
  }
  fgets(api_buf, FLAG_BUFFER, f);

  // Rest of the code

  char *user_buf = malloc(300 + 1);
  printf("What is your API token?\n");
  scanf("%300s", user_buf);
  printf("Buying stonks with token:\n");
  printf(user_buf);

  // TODO: Actually use key to interact with API

  view_portfolio(p);

  return 0;
}
```

Hey, we may take advantage of a **format string vulnerability**!
In effetti, la funzione memorizza il contenuto del file `api` proprio nel suo stack frame, e questo ci consente, eseguito uno stack dump, di ricavarne i valori, senza dover saltare da un frame all'altro con tutti i problemi che derivano dal dover preservare gli EIP e gli EBP di turno.

Ottimo, come procediamo?
Ricordiamo intanto che il dump risalira' lo stack, in quanto i primi argomenti della print 


python3 -c "print('%x' * 80, end='')" | xsel -b